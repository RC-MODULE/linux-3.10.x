/*
 * Device Tree Source for RC-Module TX011 platform
 *
 * Copyright Â© 2019 Alexey Spirkov <alexeis@astrosoft.ru>
 *
 * This file is licensed under the terms of the GNU General Public
 * License version 2.  This program is licensed "as is" without
 * any warranty of any kind, whether express or implied.
 */

/include/ "mpw7705.dtsi"

/ {
	model = "rc-module,mpw7705";
	compatible = "rc-module,mpw7705";

	aliases {
		serial0 = &uart0;
		serial1 = &uart1;
		serial2 = &uart2;
		mmc0 = &mmc0;
	};

	plb {
		lsif0 {
			greth1: greth1@0x3C034000 {
				mac-address = [ EC 17 66 77 05 02 ];
				status = "ok";
			};
			
		};

		lsif1 {						
			i2c0: i2c@0x3C05A000 {
				status = "ok";
				rtc@68 {
					compatible = "dallas,ds1338";
					reg = <0x68>;
				};
			};						

			uart0: uart0@3C05D000 {
				status = "ok";
			};

			uart1: uart2@3C05E000 {
				status = "ok";
			};

			uart2: uart3@3C05F000 {
				status = "ok";
			};

			spi0: spi0@0x3C061000 {
				status = "ok";

				spi_flash@0 {
					compatible = "st,m25p32", "spi-flash";
					reg = <0>;
					spi-max-frequency = <20000000>;
				};
				
			};			

			mmc0: mmc0@0x3C064000 {
				max-frequency = <8000000>;
				cd-gpios = <&gpio1 1 0>;	/* card detect */
				status = "ok";
			};

			gpio0: gpio0@0x3C065000 {
				status = "ok";
			};

			gpio1: gpio1@0x3C066000 {
				status = "ok";
			};

			usb_otg_hs: usb_otg_hs@0x3C06D000 {
				mode = <1>;			/* 1 - host, 2 - device */
				status = "ok";
			};			
		};		
		
		apb0 {
			thermal: thermal@0x38003000 {
				status = "ok";
			};

			cpufreq: cpufreq@0x38006000 {
				/*	     freq       fb  pre post div	*/
				freqs = <200000     32  1   2   0>,
						<400000     32  1   1   0>,
						<800000     64  1   1   0>;

				status = "ok";
			};
		};

		xhsif0 {
			compatible = "ibm,apb";	 /* to check bus type */
			#address-cells = <2>;
			#size-cells = <2>;
			ranges;
			//dma-ranges = <0x40000000 0x00000000 0x00000000 0x40000000>;

			pcie0: pcie@1010000000 {
				compatible = "rcm,nwl-pcie-2.11";
				status = "ok";
				#address-cells = <3>;
				#size-cells = <2>;
				#interrupt-cells = <1>;
				msi-controller;
				device_type = "pci";
				interrupt-parent = <&MPIC>;
				interrupts = <86 4>, /* misc */
						<87 4>,	/* DMA */
						<85 4>,	/* legacy */
						<84 4>,	/* MSI_1 [63...32] */
						<83 4>;	/* MSI_0 [31...0] */
				interrupt-names = "misc", "dummy", "legacy",
						"msi1", "msi0";
				msi-parent = <&pcie0>;
				reg = <0x010 0x10000000 0x0 0x1000000>,	/* PCI0 */
					<0x10 0x3c000000 0x0 0x10000>,		/* xhsif0 pci control */
					<0x10 0x11000000 0x0 0x1000000>,	/* ecam */
					<0x10 0x3cb00000 0x0 0x40000>;		/* serdes */
				reg-names = "breg", "pcireg", "cfg", "serdes";

//                        pci_space  < pci_addr          > < cpu_addr          > < size       >
//				ranges = <0x02000000 0x00000000 0x12020000 0x00000010 0x12020000 0x0 0x00040000>;
				ranges = <0x03000000 0x00000000 0x12020000 0x00000010 0x12020000 0x0 0x05FE0000>;
//				dma-ranges = <0x03000000 0x1 0x0 0x0 0x00000000 0x1 0x0>;

				bus-range = <0x00 0x0f>;
				interrupt-map-mask = <0x0 0x0 0x0 0x7>;
				interrupt-map = <0x0 0x0 0x0 0x1 &pcie0_intc 0x1>,
						<0x0 0x0 0x0 0x2 &pcie0_intc 0x2>,
						<0x0 0x0 0x0 0x3 &pcie0_intc 0x3>,
						<0x0 0x0 0x0 0x4 &pcie0_intc 0x4>;
				pcie0_intc: legacy-interrupt-controller {
					interrupt-controller;
					#address-cells = <0>;
					#interrupt-cells = <1>;
				};
			};
		};

		xhsif1 {
			compatible = "ibm,apb";	 /* to check bus type */
			#address-cells = <2>;
			#size-cells = <2>;
			ranges;
			//dma-ranges = <0x40000000 0x00000000 0x00000000 0x40000000>;

			pcie1: pcie@1018000000 {
				compatible = "rcm,nwl-pcie-2.11";
				status = "disabled";
				#address-cells = <3>;
				#size-cells = <2>;
				#interrupt-cells = <1>;
				msi-controller;
				device_type = "pci";
				interrupt-parent = <&MPIC>;
				interrupts = <94 4>, /* misc */
						<95 4>,	/* DMA */
						<93 4>,	/* legacy */
						<92 4>,	/* MSI_1 [63...32] */
						<91 4>;	/* MSI_0 [31...0] */
				interrupt-names = "misc", "dummy", "legacy",
						"msi1", "msi0";
				msi-parent = <&pcie1>;
				reg = <0x010 0x18000000 0x0 0x1000000>,	/* PCI0 */
					  <0x10 0x3c010000 0x0 0x10000>,	/* xhsif1 pci control */
					  <0x10 0x19000000 0x0 0x1000000>,	/* ecam */
					  <0x10 0x3cb40000 0x0 0x40000>;	/* serdes */
				reg-names = "breg", "pcireg", "cfg", "serdes";

//                        pci_space  < pci_addr          > < cpu_addr          > < size       >			// https://elinux.org/Device_Tree_Usage#PCI_Host_Bridge
				ranges = //<0x03000000 0x00000004 0x00000000 0x00000013 0x00000000 0x1 0x00000000>;
//						  0x01000000 0x00000000 0x1a020000 0x00000010 0x1a020000 0x0 0x00020000
						  <0x43000000 0x00000000 0x1a020000 0x00000010 0x1a020000 0x0 0x05FE0000>;

				// dma-ranges = <0x03000000 0x1 0x0 0x0 0x00000000 0x1 0x0>;

				bus-range = <0x00 0x0f>;
				interrupt-map-mask = <0x0 0x0 0x0 0x7>;
				interrupt-map = <0x0 0x0 0x0 0x1 &pcie1_intc 0x1>,
						<0x0 0x0 0x0 0x2 &pcie1_intc 0x2>,
						<0x0 0x0 0x0 0x3 &pcie1_intc 0x3>,
						<0x0 0x0 0x0 0x4 &pcie1_intc 0x4>;
				pcie1_intc: legacy-interrupt-controller {
					interrupt-controller;
					#address-cells = <0>;
					#interrupt-cells = <1>;
				};
			};
		};

		dspcores {
			nmc3_0_core0: nmc3_0_core0@0x39000000 {
				core-name = "K1879-nmc";
				status = "ok";
			};
			nmc3_0_core1: nmc3_0_core1@0x39020000 {
				core-name = "K1879-nmc";
				status = "ok";
			};
			nmc3_1_core0: nmc3_1_core0@0x39040000 {
				core-name = "K1879-nmc";
				status = "ok";
			};
			nmc3_1_core1: nmc3_1_core1@0x39060000 {
				core-name = "K1879-nmc";
				status = "ok";
			};
		};
	};

	thermal-zones {
			cpu-thermal {
					polling-delay-passive = <0>;
					polling-delay =  <1000>; 
					thermal-sensors = <&thermal>;
					
					trips {
							cpu-crit {
									temperature     = <100000>;
									hysteresis      = <0>;
									type            = "critical";
							};
					};

					cooling-maps {
					};
			};
	};

	chosen {
		stdout-path = &uart0;
	};
};
